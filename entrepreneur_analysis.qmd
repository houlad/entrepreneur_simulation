---
title: "Untitled"
format: 
  html:
    code-fold: true
editor: visual
editor_options: 
  chunk_output_type: console
knitr:
  opts_chunk: 
    set: (dev = "ragg_png")
---

```{r package-load, warning=FALSE, message=FALSE}
library(tidyverse)
library(ggsci)
library(pins)
library(patchwork)
library(gt)
```

There is common adage these days that goes something like this: the wealthy, and billionaires in particular, are not genius investors, they just have more rolls of the dice at the investment table than you do. So let's say you work and work, eventually saving up \$100,000 to invest in a startup that you just know is going to become the next Apple. That's great, and you might even be correct and make a lot of money, but those that *start* wealthy, according to the adage, will invest \$100,000 in the next Apple, but they'll also be able to invest in 10, 20, 30 other startups that may or may not hit it big too. Another way you hear this is as throws of a dart- you have one dart to hit the bullseye, someone else has 10 darts to hit it. Who do you think is going to perform better on average?

This adage has always stuck in the back of my mind as something that is potentially true, but also something that I have a hard time visualizing. It would be great if I could have concrete numbers that I can look at and analyse to really intuit what exactly this starting advantage means in terms of the resultant wealth generated. Well, lucky for me I love exploring topics via simulations. Maybe it's just me, but often I find results from statistics and probability confusing and difficult to really parse and internalize, but when I can build a simulation, even though it's necessarily simplified, I can flesh out a deeper understanding of the mechanics of what is taking place. Let's figure out how we're going to approach this.

# Problem Statement and Assumptions

The core of the adage, I think, rests in the premise that more investment 'throws', or attempts, are the determinative factor in who becomes a billionaire, not intelligence, investing skill, hard work or whatever other performance based metric you want to cite. The number of investment attempts are a product of whatever starting capital you are fortunate enough to either have or be able to save/raise. So the spirit of the question is really - given all else equal, is who becomes ultra-wealthy (say worth more than \$100 million dollars) determined mainly by how much initial investment capital they have? First, let's pin down a little more firmly how the simulation will work and then state the, numerous, assumptions we have to make in this sort of analysis.

## Investment Simulation Description

Very broadly, the simulation can be broken down into two parts. One part that simulates a single investment outcome and another part that uses the single investment logic to make repeated investments based on certain conditions. The first part, called **make_one_investment**, is basically just a person who is repeatedly throwing a n-sided die where n is the number of possible investment outcomes. **make_one_investment** is an extremely simple function that takes 3 arguments:

### Part One: *make_one_investment*

```{r die-throw}
make_one_investment <- function(returns_vector = c(0, 1, 3, 5, 10, 20),
                                probs_vector = c(.64, .18, .06, .07, .03, .02), investment){
  # Given a numeric initial investment, return the amount of income generated by the investment
  assertthat::assert_that(is.numeric(investment), msg = "investment must be numeric")
  assertthat::are_equal(length(returns_vector), length(probs_vector), msg = 'returns_vector and probs_vector must be the same length')
  
  sample(x = returns_vector, prob = probs_vector, size = 1, replace = TRUE) * investment
}
```

-   **investment**: a dollar amount to 'bet' on the investment throw
-   **returns_vector**: a vector of the possible return amounts for a given investment. A vector of (0, 5, 10) would mean on a \$10 investment, you could either get \$0, \$50, or \$100 back.
-   **probs_vector**: a vector giving the probability of getting each of the different return amounts back. A vector of (.8, .19, .01) would indicate that you have an 80% chance of getting \$0 back, a 19% chance of getting \$50 back, and a 1% chance of getting \$100 back on your initial investment of \$10.

Each time **make_one_investment** is called, it will return the amount of money you got back from a single investment attempt. If your investment was \$10 and you hit a return vector of 10, **make_one_investment** would return a value of 100. This simple function is the core of the investment simulation. It will allow us to make thousands of simulations based on whatever investment table(I will refer to a given return vector and its accompanying probability vector as the investment table of a simulation) we are interested in at the moment.

```{r example-investment}
make_one_investment(investment = 100)
```

### Part Two: *investment_sim*

A single investment throw is not what we are after though. We want to be able to examine a series of investments and, at the end of some period of time, examine how much that investor made or lost. To simulate that, we need some more simulation scaffolding. The following **investment_sim** code might look intimidating at first, but it is so simple even a dummy like me could write it. Let's break it down step by step.

```{r investment-sim-the-whole-function, eval = FALSE}
investment_sim <- function(investment_capital, investment_size,
                           reinvestment_perc = NULL, max_rounds = 250,
                           sim_id = 1, ...){
  # Given an initial amount of investment capital, an initial investment size and an
  # amount of profits to reinvest, return a simulated investment history
  
  
  # Amount you've made from the investments + capitalized interest after every 6 funding rounds
  total_profit <- 0
  
  # Capital you are willing to invest
  bankroll <- investment_capital
  # Total companies funded
  companies_funded = 0
  # Total rounds of funding
  funding_rounds = 0
  
  # Initialize a list; stores the results of each round
  round_results <- list()
  
  # You keep investing while your backroll is >= the minimum investment size & you haven't hit the max number of investment rounds
  while(bankroll >= investment_size & funding_rounds < max_rounds){
    
    # # how many investments you can afford with current bankroll
    # num_of_investments <- floor(bankroll/investment_size)
    
    # leftover bankroll after subtracting out cost of investment
    remainder_bankroll <- bankroll - investment_size
    
    # This is the actual simulation core. Make one investment; 
    # Returns according to make_one_investment investment returns table
    investment_revenue <- make_one_investment(investment = investment_size, ...)
    
    # Calculate profit from investments
    profit <- investment_revenue - investment_size
    
    # Iterate # of companies funded
    companies_funded <- companies_funded + 1
    
    # Iterate # of rounds into simulation 
    funding_rounds <- funding_rounds + 1
    
    
    # Every 6 rounds, capitalize the total profit made @5%. 
    if(funding_rounds %% 6 != 0){
      # If the investment generated a profit, add (1- reinvestment_perc) * profit to your total_profit
      # Add the reinvestment_perc * profit to your bankroll
      if(profit > 0){
        total_profit <- total_profit + (profit * (1 - reinvestment_perc))
        bankroll <- remainder_bankroll + investment_size + (profit * reinvestment_perc)
        # If the investment generated a loss(or was flat), add remaining bankroll + any investment revenue(which should be = investment cost)
      } else{
        bankroll <- remainder_bankroll + investment_revenue
      }
      
    } else{
      if(profit > 0){
        total_profit <- total_profit + (profit * (1 - reinvestment_perc))
        bankroll <- remainder_bankroll + investment_size + (profit * reinvestment_perc)
      } else{
        bankroll <- remainder_bankroll + investment_revenue
      }
      # Profit capitalized every 6th funding round @ 5%
      total_profit <- total_profit * 1.05
      
    }
    
    # If your total profit at least 10 times more than your initial investment capital
    # AND your current bankroll is less than the amount needed to make an investment
    # take one investment worth of money out of your profit and deposit it into your current bankroll so you
    # can continue to invest
    if(total_profit / investment_capital >= 10 & bankroll < investment_size){
      total_profit <- total_profit - investment_size
      bankroll <- bankroll + investment_size
    }
    
    # storing the results of each 'round'
    round_results[[funding_rounds]] <- tibble(
      sim_id = sim_id,
      round = funding_rounds,
      start_capital = investment_capital,
      investment_size = investment_size,
      # round level results
      revenue_for_round = investment_revenue,
      profit_for_round = profit,
      # aggregate level results
      total_realized_profit = total_profit,
      current_bankroll = bankroll, 
      total_companies_funded = companies_funded,
    )
  }
  # bind all the simulation results into one tibble
  return(purrr::list_rbind(round_results))
}
```

First, I need to define some variables:

-   **investment_capital**: the total amount of starting capital the investor has to invest

-   **investment_size**: the amount of money invested in a single investment

-   **reinvestment_perc**: a decimal amount indicating the percentage of investment profits you'd like to add to your investment account with which to make further investments

-   **max_rounds**: a maximum number of investments/rounds of investments you want to make

-   **sim_id**: an identifier used to keep track of investors

Everything else in this first chunk is just initializing variables to keep track of the various quantities we are interested in. These quantities are totals from all the simulations that have occurred so far. It is probably important to distinguish total profit and bankroll since I don't think it is immediately obvious what the difference between the two is. Total profit is the total amount of profit accumulated for all investments, while bankroll is the amount of money currently available with which to make future investments. They are distinct quantities and do not overlap.

```{r tracking-metrics-round-over-round, eval = FALSE}
investment_sim <- function(investment_capital, investment_size,
                           reinvestment_perc = NULL, max_rounds = 250,
                           sim_id = 1, ...){
  # Given an initial amount of investment capital, an initial investment size and an
  # amount of profits to reinvest, return a simulated investment history
  
  
  # Amount you've made from the investments + capitalized interest after every 6 funding rounds
  total_profit <- 0
  
  # Capital you are willing to invest
  bankroll <- investment_capital
  # Total companies funded
  companies_funded = 0
  # Total rounds of funding
  funding_rounds = 0
  
  # Initialize a list; stores the results of each round
  round_results <- list()
```

Next, we get the functionality that allows us to simulate repeated investment rounds.

```{r main-while-loop-functionality, eval = FALSE}
while(bankroll >= investment_size & funding_rounds < max_rounds){
    
    # leftover bankroll after subtracting out cost of investment
    remainder_bankroll <- bankroll - investment_size
    
    # This is the actual simulation core. Make one investment; 
    # Returns according to make_one_investment investment returns table
    investment_revenue <- make_one_investment(investment = investment_size, ...)
    
    # Calculate profit from investments
    profit <- investment_revenue - investment_size
    
    # Iterate # of companies funded
    companies_funded <- companies_funded + 1
    
    # Iterate # of rounds into simulation 
    funding_rounds <- funding_rounds + 1
    
    
    # Every 6 rounds, capitalize the total profit made @5%. 
    if(funding_rounds %% 6 != 0){
      # If the investment generated a profit, add (1- reinvestment_perc) * profit to your total_profit
      # Add the reinvestment_perc * profit to your bankroll
      if(profit > 0){
        total_profit <- total_profit + (profit * (1 - reinvestment_perc))
        bankroll <- remainder_bankroll + investment_size + (profit * reinvestment_perc)
        # If the investment generated a loss(or was flat), add remaining bankroll + any investment revenue(which should be = investment cost)
      } else{
        bankroll <- remainder_bankroll + investment_revenue
      }
      
    } else{
      if(profit > 0){
        total_profit <- total_profit + (profit * (1 - reinvestment_perc))
        bankroll <- remainder_bankroll + investment_size + (profit * reinvestment_perc)
      } else{
        bankroll <- remainder_bankroll + investment_revenue
      }
      # Profit capitalized every 6th funding round @ 5%
      total_profit <- total_profit * 1.05
      
    }
```

This basically says, while

1)  your bankroll has enough money in it to make another investment AND
2)  you haven't made the maximum number of investments

you should keep making investments. Within the while loop, you do the actual investing with the **make_one_investment** function, keeping track of the profit and revenue from each investment. There are a couple important things that occur here as well.

-   Every investment round, determine if the investment generated a profit or a loss. If it generated a profit, add the percentage of the profit you want to reinvest to your bankroll and add the rest to your total profit. If it generated a loss, update your bankroll to reflect the loss.

-   Every 6th round, we are going to say our total profits, which are sitting in some Vanguard style investment account, earn 5% interest and we update total profits accordingly.

Finally, in this last chunk, if our total profit is currently at least 10 times greater than whatever capital amount we started this whole thing with AND our bankroll is currently so low that we can't make another investment, we will transfer money from our total profit to our bankroll to allow us to make another investment. This is definitely a judgement call, but it seemed pretty reasonable to put a condition like this into the simulation. It didn't seem particularly realistic that if someone had increased their initial capital by an order of magnitude or more that they wouldn't shift some of the profit they'd made to keep making investments.

```{r update-bankroll-and-save-round-results, eval = FALSE}
if(total_profit / investment_capital >= 10 & bankroll < investment_size){
      total_profit <- total_profit - investment_size
      bankroll <- bankroll + investment_size
    }
    
    # storing the results of each 'round'
    round_results[[funding_rounds]] <- tibble(
      sim_id = sim_id,
      round = funding_rounds,
      start_capital = investment_capital,
      investment_size = investment_size,
      # round level results
      revenue_for_round = investment_revenue,
      profit_for_round = profit,
      # aggregate level results
      total_realized_profit = total_profit,
      current_bankroll = bankroll, 
      total_companies_funded = companies_funded,
    )
}

return(purrr::list_rbind(round_results))
```

The last snippet is just saving the individual investment rounds into the data frame that gets spit out at the end of the full simulation. That in a nutshell is how our investment simulation will work.

### Assumptions

There are a ton of implicit or explicit assumptions I'm making that we should take note of right away.

-   If our investor has enough money in their bankroll to make an investment-and the maximum number of investment rounds hasn't been reached-then they will continue to make investments. Is this the optimal investment strategy? Almost certainly not, but I am not an investor, and rigging up some complicated investment logic is not really the point of this investigation.

-   Our investment returns are totally determined by the investment table. As such all investors are playing by the same rules. If the probabilities of getting returns *x, y, z* are (.8, .19, .01), then those are the probabilities for *everyone* in that simulation. This most certainly is ignoring, at the very least, things like insider trading or just simply having access to better or more recent information about investments. As we will see when we add in the concept of a *good* investor, this ultimately doesn't seem to make an enormous difference.

-   Our investment outcomes are immediately known. In reality, you invest in a startup and it might be a decade before you have any idea what the end result of that investment is. In our simulation, you instantly know and you collect that profit or loss. Then, if you are able, you move on to the next investment. This is completely unlike how you invest in the real world, but it's a helpful simplification. We can think of these simulations as taking a birds eye omniscient view. At the end of our imaginary investors lives, we look at every investment they made and see how things panned out.

-   Our investors live in a world with no taxes and extremely stable return rates. Neither of these conditions are true, but again, they are simplifying assumptions and I'm going to make them. An alternative approach I considered, but ultimately didn't use, with respect to returns rates and probabilites was to draw them from a distribution for each investment throw. This would mean that each investment has a different set of returns and probabilities drawn from some prior distribution. I think there is probably some merit to this approach, but I leave it as a fun extension to explore for any readers.

-   Our investors only choice is to invest or not to invest, and that is determined entirely by whether they have enough money to meet the investment size (and of course whether they've hit the maximum number of investments). In reality, an investor makes a ton of micro decisions. When do they want to cash out an investment? Do they want to invest *more* than the minimum in this investment because they are extra confident it will pay a high return? Do they want to go into debt(can they even?) to finance an investment? Do they have some way of leveraging this investment to increase their returns even more? None of these things are modeled by our simulation, but ultimately that's the point. This is a simplification so we can examine the role of starting capital under conditions where all these other factors don't come into the equation.

-   Our investors invest serially-that is, they make an investment, get a return, and then make another investment. This is not at all how venture capitalists invest. They invest in 20 different companies at the same time and expect the 'unicorn' among them to be what grants them a windfall profit when most of the companies go bankrupt or otherwise fail. I played around with making many investments at one time, but ultimately decided to take the serial approach. It was simpler and the end results were more or less the same.

There are dozens of other assumptions and simplifications I'm sure I've made, but the important thing to bear in mind is that that is OK. Is this a realistic investing scenario? Absolutely not! But I think we can still learn valuable information from it.

# Simulation Criteria

With a way to simulate a series of investments, we can now look at some results. Using the **perform_sim** function, I generated batches of simulations with the following criteria:

```{r perform-sim, eval = FALSE}
perform_sim <- function(num_sims, .starting_capital, .investment_size,
                        .reinvestment_perc, ...){
  future_map_dfr(1:num_sims, .f = function(.x, ...){
    investment_sim(investment_capital =  .starting_capital, 
                    investment_size = .investment_size,
                    reinvestment_perc = .reinvestment_perc,
                    sim_id = .x, ...)},
    ...,
    .options = furrr_options(seed = 123))
}
```

-   Each simulation batch consists of 100,000 investors

-   A constant investment size of 1,000,000 for all simulations

-   Starting capital:

    -   1,000,000 (small/single/1x)
    -   10,000,000 (medium/multiple/10x)
    -   20,000,000 (large/big/20x)

-   Reinvestment Percentage:

    -   25%
    -   50%
    -   75%

-   Investment Tables:

    -   Default: This was a 'realistic' venture capital return table of
        -   Returns: (0, 1, 3, 5, 10, 20)
        -   Probabilities: (.64, .18, .06, .07, .03, .02)
    -   Stingy: Set up to yield the lowest return multiple at the top end
        -   Returns: (0, 1, 10)
        -   Probabilities: (.8, .15, .05)
    -   Boom or Bust: Set up to either lose your investment or, with a tiny chance, return a huge amount
        -   Returns: (0, 50)
        -   Probabilities: (.99, .01)

-   'Good' investor: Investors in a simulation are either normal investors who play by the rules of whatever investment table is in use in that simulation batch or they are 'good' investors. Good investors have 20% higher return probabilities for any return amount other than 0. For example, for a stingy investment table, a 'good' investor has the following investment table.

    -   Returns: (0, 1, 10)
    -   Probabilities: (.76, .18, .06)

-   Each simulation has a maximum of 250 investment rounds.

I decided not to simulate *every* permutation of these variables(mainly for the sake of time), but I still wound up running 22 different simulations in total.

# Simulation Results

```{r load-simulations, cache = TRUE, cache.lazy = FALSE, eval = FALSE}
# Read in the saved data from pins. It will be in a list of dataframes that can
# be accessed by the investment structure; generally this is defined as follows:
# single, multiple(10x), or big multiple(20x) investment
# small reinvestment, medium reinvestment, large reinvestment
# realistic investment table(default in all reinvestment dfs), stingy investment table, win or lose investment table
# normal investor (default) vs good investor(return percentages for all values except 0 return are 20% higher)
data_board <- pins::board_folder(path = 'data', versioned = TRUE)

all_simulations <- map(list.files('data/'), ~pin_read(data_board, .x) |>  mutate(id = .x))

# label the data frames within the list with their simulation type
names(all_simulations) <- list.files('data/')
```

### Racing Plots

A good starting point is examining what I'm calling racing plots(even though I think racing plots are normally animated). In these plots, each grey line represents the investment results of a single investor round by round, with the red dotted line indicating \$100,000,000 and the black dashed line indicating \$1,000,000,000.

#### 1x, 10x, 20x Starting Capital

Looking at our 1x, 10x, and 20x starting capital variations, we can immediately get a sense of the immense growth some investors will see. Remember, all of these investors are investing \$1,000,000 per investment and starting with either \$1,000,000, \$10,000,000 or \$20,000,000. Regardless of the starting capital, some investors in all the simulations accumulated over a billion dollars, with the five highest returns (lines colored with shades of blue) all easily hitting that mark. While all starting capital variations produced billionaires, the shape and spread of the plots tells us that they did not do so at the same rate. Looking at the right side of the plot, the top plot with 1x investment results clearly has a wider spread and has fewer lines above the billion dollar dashed line. The higher, and narrower, band of grey investor lines in the 10x and 20x plots indicate that, on average, the more starting capital you begin investing with, the higher your final income will be.

It is extremely important to clarify a couple things right away though. These racing plots obfuscate just how few investors are making these enormous investment returns. For example, in the top plot where investors only start with a single investment worth of capital, every line you see on the plot is an investor whose first investment was, at the very least, a break even investment. If it wasn't, they lost all their investment capital and they are out of the investment game altogether, and thus not represented on this plot. We will look at this more closely in a moment, but just to give you an idea, in this single investment(realistic investment table) scenario, over 75% of investors in the simulation lost money. *All* the lines on the racing plots are winners in the simulations, so perhaps the best way to think of them is as a good way to visualize the growth and variance of investment returns amongst those investors who got lucky and hit good investments.

![Starting Capital Racing Plot](starting_capital_racing_plot.png){width="100%"}

#### 1x Investment Capital with Realistic, Stingy, Boom-Bust Investment Tables

Moving on to the various investment tables, we can see how enormous the difference between the different tables is. If you were to do something like calculate the expected values and expected variance of the different investment tables, you wind up with something like this:

-   Expected Value: realistic table \> stingy table \> boom-bust table
-   Expected Variance: boom-bust table \> realistic table \> stingy table

I think this racing plot illustrates that well. The realistic table clearly produces the most billionaires, but it also has the densest bunch of lines, indicating that there are more investors that wound up with positive investment results.

Our stingy table investors failed to yield any billionaires, but that's what I expected when we set the maximum return at 10x. Typically in venture capital, investors expect most of their investments to fail, but they expect a single investment here and there to produce massive (30x+) returns and overwhelm all the other failures. If you don't have that windfall investment possibility, it is significantly tougher to weather the periods where investments aren't panning out to get to that next windfall investment. So this is a little more evidence that my simulation is producing somewhat empirically valid results.

Finally, the boom-bust table, somewhat counterintuitively, still produces billionaires, but not nearly as many or as many overall winners as the realistic investment table. I find it pretty amazing that when 99 out of 100 investments result in a loss of all your capital, you can *still* get lucky enough to become a billionaire if your potential returns on that 1 out of 100 investment are big enough--remember in this case that 1% investment returns 50x.

![Investment Tables 1x Racing Plot](investment_tables_racing_plot.png){width="100%"}

#### 10x Investment Capital with Realistic, Stingy and Boom-Bust Investment Tables

Does having 10 times more starting capital change the outcome for the various investment tables? Yes, but, at least judging by these plots, not as much as you'd think. We see a shift upward for the realistic and the boom-bust investment tables, resulting in more billionaires and more successful investors, but the plot doesn't do a good job of conveying how big the resulting shift was. The stingy investors appeared to fare even worse than the 1x investors, but this is largely an illusion as we'll see a little bit later on.

![Investment Tables 10x Racing Plot](investment_tables_multiple_racing_plot.png){width="100%"}

#### Normal versus Good Investors 1x Starting Capital

Finally, what effect does your investing skill have on your investment outcome? Well, again, not as much as you'd think. It's absolutely true that our good investors have more billionaires and earned more on average than the normal investors, but this isn't an order of magnitude jump. We'll get into exact amounts later on, but being a good investor versus a normal one looks a lot like the difference between reinvesting 25% verse reinvesting 50% of your profits as seen in the reinvestment percentage plot.

![Normal v Good Investors 1x Starting Capital](single_normal_v_good.png){width="100%"}

#### Small, Medium, Large Reinvestment Percentages with 1x Starting Capital

![Small, Medium, Large Reinvestment Percentage](single_small_medium_large_reinvestment.png){width="100%"}

### Using Histograms to Discover Bimodality

I don't know about you, but overall, I'm left a little unsatisfied by the racing plots. We got a good sense of what the growth of the successful investors looked like and maybe a sense of how many billionaires were produced, but if you only look at the racing plots, it might seem like every investor in every simulation ends up a millionaire. That is not true, but we have to move on from racing plots to visualize this. One option is our trusty histogram.

![1x, 10x, 20x Starting Capital with Realistic Investment Table](starting_capital_histogram.png){width="100%" #fig-test}

The above plot[^1] shows our different starting capital options and immediately a different picture emerges than with the racing plots. First, note that all of the histograms are bimodal. We have a large hump on the left that represents most of our investors-those who generally fared poorly- and then a second, small hump on the right that represents the investors who hit it big. Concretely, for the 1x plot at the top, that first bar of the histogram represents the nearly 80,000(of a total of 100,000!) investors who lost money. The second hump to the right seems huge, but, notice, we are working on a log scale y-axis. Almost all the bars on the second hump contain less than 100 investors a piece, and all of them above the \$1,000,000,000 mark are below 10 investors. In other words, the second hump represents a tiny fraction of the total investors.

[^1]: Do you notice that the x-axis on the histograms seems to contain gaps-almost like they've been painted over with whiteout? That is an artifact of plotting these histograms with the y-axis on a log scale. The y-axis starts at 1, not zero, and so bins on the histogram with a single count(of which there are many) are there, but only show up as a tiny blip, blotting over some of the x-axis. This is annoying, but I think this tradeoff is worth it to have a more interpretable y-axis and plot otherwise.

Second, note that while the 10x and 20x plots are still bimodal, it's like they have been stretched and shifted to the right. The left hump still represents the majority of the investors, but now, some of those 'poor' investors made a good chunk of money. And the right hump, still a minority of investors, keeps getting narrower and shifting more to the right. In other words, the winners are making more money and the losers are both fewer in number and they are losing less that those investors in the 1x plot.

#### Do Good Investors Change this Dynamic?

If we take it a step further and ask whether these dynamics change with good investors, the answer seems to be no. Good investors appear to push a few more investors into the right hump of the histogram and make those winners make a little more money. With the 20x investors, this shift appears to be the most exaggerated, but I'd still hesitate to say something is fundamentally different with the good investors. We still have pronounced bimodal data and we still see roughly the same overall shape, just squished upward a tad.

I won't flood this post with a histogram of every investment scenario, but you see this basic pattern in most of the plots-bimodal with a large majority of investors losing money and a small minority reaping enormous gains.



![1x, 10x, 20x Starting Capital, Realistic Investment  Table, GoodInvestors](starting_capital_good_investor_histogram.png){width="100%"}


### How much of a difference does the amount of starting capital actually make?

After a lot of meandering, we can finally come back to our motivating question: are investors who become ultra-wealthy mainly a product of how much starting capital they have? To make a call on this, we need to look at actual investment results.

![Realistic Investment Table Returns Bar Plot](realistic_returns_plot.png){width=100%}

The above bar graph shows investment return percentages for each of our starting capital amounts and for the three different return tables we've used in our simulations. What should be immediately clear is that investment returns decrease as your starting capital decreases. Looking at our realistic investment table, the 20x starting capital group has over 50% of its investors who made 100% return or greater. Putting that in real numbers, that means when they started with 20 million dollars, over 50% of investors wound up with at least 40 million dollars at the end of their investment run. Our 10x starting capital group still has nearly 40% of its investors earning at least 100% return rates, but we have to be careful with our interpretation here. A 100% return for our 10x group means they 'only' finished with at least 20 million dollars. For our 1x capital group, that ~15% of investors that earned at least 100% returns 'only' finished with at least 2 million dollars. This is certainly good evidence for starting capital being an enormously important factor when it comes to final investor wealth, but if you are like me, this still isn't entirely satisfying. Aren't we really asking how many centimillionaires or billionaires these various starting capital amounts produced?

#### How Much Profit Are These Investors Actually Making?

When we look at what portion of investors reach various levels of wealth, we see more evidence that your starting capital plays a critical role in final investment wealth. Most investors with 10x or 20x starting capital wind up at the very least with millions in profit, while the vast majority of 1x investors don't reach millionaire level profits.

![Millionaire Bar Plot](millionaire_bar_plot.png){width=100%}
![Millionaire Table](millionaire_table.png){width=100%}

Perhaps this is even clearer if we take the data from all our simulations(except the handful with different reinvestment percentages) and tally up how many millionaires, billionaires, etc we have. That is 1.8 million simulated investors with 600k investors for each starting capital amount. The bar graph below is the result. You can see immediately that the overwhelming majority if centimillionaires and billionaires came from 10x or 20x starting capital simulations. This isn't something that is statistically marginal and we should probably do a hypothesis test or something to be on more firm footing. In my opinion, this is one of those 'oh, this is obviously true' plots.

![Total Millionaires Bar Plot](total_millionaire_bar_plot.png){width=100%}


And even if you don't care as much about strictly falling into millionaire/billionaire buckets, we can look at who made or lost money and see essentially the same results. If you are working with 20x starting capital, it's not a sure thing you are going to make money as an investor, but it's basically a coin flip. You have a sizeable number of investments you can make before you run out of your initial capital, so even when you are no better an investor than anyone else, you simply have more time to get lucky and hit an investment that is good.
![Winner Loser Bar Plot](winner_loser_bar_plot.png){width=100%}
![Winner Table](winner_loser_table.png){width=100%}

```{r eval = FALSE}
# Read in the saved data from pins. It will be in a list of dataframes that can
# be accessed by the investment structure; generally this is defined as so:
# single investment vs multiple investment
# small reinvestment, medium reinvestment, large reinvestment
# realistic investment table(default in all reinvestment dfs), stingy investment table, win or lose investment table
# normal investor (default) vs good investor(return percentages for all values except 0 return are 20% higher)
data_board <- pins::board_folder(path = 'data', versioned = TRUE)

all_simulations <- map(list.files('data/'), ~pin_read(data_board, .x) |>  mutate(id = .x))

# label the data frames within the list with their simulation type
names(all_simulations) <- list.files('data/')

my_plot_theme <- function(base_family="Karla", 
                          base_size =12,
                          plot_title_family='Karla',
                          plot_title_size = 16,
                          grid_col='#dadada') { 
  aplot <- ggplot2::theme_minimal(base_family=base_family, base_size=base_size) #piggyback on theme_minimal 
  aplot <- aplot + theme(panel.grid=element_line(color=grid_col))
  aplot <- aplot + theme(plot.title=element_text(size=plot_title_size, 
                                                 family=plot_title_family))
  aplot <- aplot + theme(axis.ticks = element_blank())
  aplot
}

plot_racing_graph <- function(df, title = NULL,
                              subtitle = NULL,
                              .x_label = NULL){
  
  # Identify the 5 sims that returned the highest total dollar amount
  highlighted_values <- df |> 
    group_by(sim_id) |> 
    filter(round == max(round)) |> 
    ungroup() |> 
    slice_max(total_realized_profit + current_bankroll, n = 5) |> 
    pull(sim_id)
  
  # TODO document functionality
  df |> 
    ggplot()+
    geom_line(aes(x = round, y = total_realized_profit+current_bankroll, group = sim_id, color = sim_id, alpha = .25))+
    gghighlight::gghighlight(sim_id %in% highlighted_values, max_highlight = 5,
                             use_group_by = FALSE,
                             unhighlighted_params = list(colour = alpha('grey', .25)),
                             use_direct_label = FALSE)+
    geom_hline(yintercept = 100000000, linetype = 'dotted')+
    geom_hline(yintercept = 1000000000, linetype = 'dashed')+
    scale_y_continuous(labels = scales::number_format(big.mark = ","),
                       breaks = seq(0, 1500000000, by = 250000000),
                       minor_breaks = seq(0, 1500000000, by = 100000000))+
    theme_minimal()+
    labs(
      x = .x_label,
      y = "Total Investment Income",
      title = title,
      subtitle = subtitle
    )+
    my_plot_theme() + 
    theme(
      legend.position = 'None'
    )+
    scale_color_viridis_c()
}

calculate_return_rate_metrics <- function(df){
  # params: df - a tibble containing round by round simulation results
  # returns: a single row tibble containing binned 
  
  df |> 
    group_by(sim_id) |> 
    filter(round == max(round)) |> 
    ungroup() |>  
    mutate(end_wealth = total_realized_profit + current_bankroll,
           end_profit_or_loss = end_wealth - start_capital,
           perc_return = (end_profit_or_loss/start_capital) *100) |> 
    group_by(id) |> 
    summarise(perc_lost_money = mean(perc_return < 0),
              zero_to_ten = mean(perc_return >= 0 & perc_return <= 10),
              ten_to_one_hundred = mean(perc_return > 10 & perc_return <= 100),
              one_hundred_to_one_thousand = mean(perc_return > 100 & perc_return <= 1000),
              one_thousand_to_ten_thousand = mean(perc_return > 1000 & perc_return <= 10000),
              greater_than_ten_thousand = mean(perc_return > 10000)) |> 
    mutate_if(is.numeric, ~round(.x * 100, 4))
}

calculate_return_metrics_investors <- function(df){
  df |> 
    group_by(sim_id) |> 
    filter(round == max(round)) |> 
    ungroup() |>  
    mutate(end_wealth = total_realized_profit + current_bankroll,
           end_profit_or_loss = end_wealth - start_capital,
           perc_return = end_profit_or_loss/start_capital *100) |> 
    group_by(id) |> 
    summarise(perc_lost_money = sum(perc_return < 0),
              zero_to_ten = sum(perc_return >= 0 & perc_return <= 10),
              ten_to_one_hundred = sum(perc_return > 10 & perc_return <= 100),
              one_hundred_to_one_thousand = sum(perc_return > 100 & perc_return <= 1000),
              one_thousand_to_ten_thousand = sum(perc_return > 1000 & perc_return <= 10000),
              greater_than_ten_thousand = sum(perc_return > 10000)) 
}


calculate_profit_metrics<- function(df){
  df |> 
    group_by(sim_id) |> 
    filter(round == max(round)) |> 
    ungroup() |>  
    mutate(end_wealth = total_realized_profit + current_bankroll,
           end_profit_or_loss = end_wealth - start_capital,
           perc_return = end_profit_or_loss/start_capital *100) |> 
    group_by(id) |> 
    summarise(median_profit = median(end_profit_or_loss),
            mean_profit = mean(end_profit_or_loss),
            sd_profit = sd(end_profit_or_loss),
            max_profit = max(end_profit_or_loss),
            median_end_wealth = median(end_wealth),
            mean_end_wealth = mean(end_wealth),
            max_end_wealth = max(end_wealth),
            median_perc_return = median(perc_return),
            mean_perc_return = mean(perc_return),
            sd_perc_return = sd(perc_return)) 
}

bin_dollar_value_returns <- function(df){
  df |> 
    group_by(sim_id) |> 
    filter(round == max(round)) |> 
    ungroup() |> 
    mutate(end_wealth = (total_realized_profit + current_bankroll) - start_capital) |> 
    group_by(id) |> 
    summarise(less_than_million = sum(end_wealth < 1000000),
              Millionaire = sum(end_wealth >= 1000000 & end_wealth < 10000000),
              Decamillionaire = sum(end_wealth >= 10000000 & end_wealth < 100000000),
              Centimillionaire = sum(end_wealth >=100000000 & end_wealth < 1000000000),
              Billionaire = sum(end_wealth >= 1000000000 & end_wealth < 10000000000),
              Decabillionaire = sum(end_wealth >= 10000000000))
}

lost_made_money <- function(df){
  df |> 
    group_by(sim_id) |> 
    filter(round == max(round)) |> 
    ungroup() |> 
    mutate(end_wealth = (total_realized_profit + current_bankroll) - start_capital) |> 
    group_by(id) |> 
    summarise(lost_money = sum(end_wealth < start_capital),
              made_money = sum(end_wealth > start_capital))
}

plot_histogram <- function(df, title = NULL, subtitle = NULL,
                           .x_label = NULL, .y_label = NULL, ...){
  df |> 
    group_by(sim_id) |> 
    filter(round == max(round)) |> 
    ungroup() |> 
    ggplot()+
    geom_histogram(aes((total_realized_profit + current_bankroll)-start_capital),
                    color = 'white', alpha = .8, ...)+
    scale_x_continuous(labels = scales::number_format(big.mark = ','))+
    scale_y_log10(labels = scales::number_format(big.mark = ','))+
    labs(
      x = .x_label,
      y = .y_label,
      title = title,
      subtitle = subtitle
    )+
    theme_minimal()
}


```

```{r eval = FALSE}
returns_data <- map(all_simulations, ~calculate_return_rate_metrics(.x)) |> list_rbind()
profits_data <- map(all_simulations, ~calculate_profit_metrics(.x)) |>  list_rbind()
investor_data <- map(all_simulations, ~calculate_return_metrics_investors(.x)) |> list_rbind()
millionaire_data <- map(all_simulations, ~ bin_dollar_value_returns(.x)) |> list_rbind()
winner_loser_data <- map(all_simulations, ~lost_made_money(.x)) |> list_rbind()

extract_sim_identifiers <- function(df){
  # creates identifier columns describing the type of simulation; comprised of:
  # investment_capital: small, medium, large
  #   - whether 'investor' starts with 1, 10 or 20 investments worth of capital
  #
  # investment_table: realistic, stingy, win_lose
  #   - describes which returns table (returns, probabilities) the simulation was run under
  #   - realistic: (0, 1, 3, 5, 10, 20), (.64, .18, .06, .07, .03, .02)
  #   - stingy: (0, 1, 10),(.8, .15, .05)
  #   - win_lose: (0, 50), (.99, .01)
  #
  # investor_type: good, normal
  #   - good: investor has 20% higher probability to return a positive amount.
  #        - eg probabilities for stingy investment table become (.76, .18, .06)
  #   - normal: base probabilities from the return tables are active
  #
  # sim_label: uses the first letter of each identifier to succinctly identify a simulation
  #   - eg a small investment, with a realistic table with normal investor is srn
  df |> 
    mutate(
      investment_capital = case_when(
        grepl("^single", id) ~ 'small',
        grepl("^multiple", id) ~ 'medium',
        grepl("^big", id) ~ 'large'
      ),
      investment_table = case_when(
        grepl("realistic|reinvest", id) ~ 'realistic',
        grepl("stingy", id) ~ 'stingy',
        grepl("win", id) ~ 'boom-bust'
      ),
      investment_capital_multiple = case_when(
        grepl("^single", id) ~ "1x",
        grepl("^multiple", id) ~ "10x",
        grepl("^big", id) ~ "20x"
      ),
      investor_type = if_else(grepl("good", id), 'Good', 'Normal'),
      sim_label = paste0(toupper(str_extract(investment_capital, "")), toupper(str_extract(investment_table, "")), 
                         toupper(str_extract(investor_type, ""))),
      investment_capital_multiple = factor(investment_capital_multiple, ordered = TRUE,
                                           levels = c('20x', '10x', '1x'))
    )
}


profits_data <- profits_data |> extract_sim_identifiers()
returns_data <- returns_data |>  extract_sim_identifiers()
millionaire_data <- millionaire_data |>  extract_sim_identifiers()
investor_data <- investor_data |> extract_sim_identifiers()
winner_loser_data <- winner_loser_data |> extract_sim_identifiers()


millionaire_table <- millionaire_data |> 
  select(-sim_label, -Decabillionaire, -investment_capital) |> 
  filter(investment_table == 'realistic', id != 'single_investment_medium_reinvest',
         id != 'single_investment_large_reinvest', id != 'multiple_investment_medium_reinvest',
         id != 'multiple_investment_large_reinvest', investor_type == 'Normal') |> 
  janitor::clean_names() |> 
  select(-id, -investor_type) |> 
  relocate(investment_table, investment_capital_multiple, less_than_million, millionaire,
         decamillionaire, centimillionaire, billionaire) |> 
  rename(investment_capital = investment_capital_multiple,
         '<Millionaire' = less_than_million) |> 
  gt() |> 
  tab_style(
    style = list(
      cell_text(weight = 'bold',
                transform = 'capitalize')
    ),
    locations = cells_column_labels(everything())
  ) |> 
  fmt_number(columns = where(is.numeric),
             decimals = 0)
gtsave(millionaire_table, filename = 'millionaire_table.png')


winner_loser_table <- winner_loser_data |> 
  select(-sim_label, -investment_capital) |> 
  filter(investment_table == 'realistic', id != 'single_investment_medium_reinvest',
         id != 'single_investment_large_reinvest', id != 'multiple_investment_medium_reinvest',
         id != 'multiple_investment_large_reinvest', investor_type == 'Normal') |> 
  janitor::clean_names() |> 
  select(-id, -investor_type) |> 
  relocate(investment_table, investment_capital_multiple, lost_money, made_money) |> 
  rename(invesment_capital = investment_capital_multiple) |> 
  gt() |> 
  tab_style(
    style = list(
      cell_text(weight = 'bold',
                transform = 'capitalize')
    ),
    locations = cells_column_labels(everything())
  ) |> 
  fmt_number(columns = where(is.numeric),
             decimals = 0)
gtsave(winner_loser_table, filename = 'winner_loser_table.png')

filter_by_condition <- function(df, condition, ...){
  df |> 
    filter({{condition}}, ...)
}
plot_bar_graph <- function(df, title = NULL, subtitle = NULL){
  
  df|> 
    select(-id, -investment_capital, -investment_table, -investor_type) |> 
    pivot_longer(-sim_label, names_to = 'return_amount', values_to = 'value') |>
    mutate(return_amount = case_when(
      return_amount == 'perc_lost_money' ~ '< 0 %',
      return_amount == 'zero_to_ten' ~ '0 - 10 %',
      return_amount == 'ten_to_one_hundred' ~ '10 - 100 %',
      return_amount == 'one_hundred_to_one_thousand' ~ '100 - 1,000 %',
      return_amount == 'one_thousand_to_ten_thousand' ~ '1,000 - 10,000 %',
      return_amount == 'greater_than_ten_thousand' ~ '> 10,000 %'
    )) |> 
    mutate(return_amount = factor(return_amount, ordered = TRUE, 
                                  levels = c("< 0 %", "0 - 10 %",
                                             "10 - 100 %", "100 - 1,000 %",
                                             "1,000 - 10,000 %", "> 10,000 %"))) |> 
    ggplot(aes(x = sim_label, y = value, fill = fct_rev(return_amount)))+
    geom_bar(position = 'fill', stat = 'identity', alpha = .75)+
    scale_fill_nejm()+
    theme_minimal()+
    scale_y_continuous(labels = scales::percent_format())+
    labs(
      x = "",
      y = "",
      title = title,
      subtitle = subtitle,
      fill = 'Return Percentage'
    )+
    theme(
      panel.grid.major.x = element_blank()
    )
}
```

```{r eval = FALSE}
millionaire_data |> 
  filter(id != 'multiple_investment_large_reinvest', id != 'multiple_investment_medium_reinvest', 
         id != 'single_investment_large_reinvest', id != 'single_investment_medium_reinvest') |> 
  select(-id, -sim_label, -investment_table,-investment_capital_multiple, -investor_type, -Decabillionaire) |> 
  pivot_longer(-investment_capital, names_to = 'return_amount', values_to = 'value') |> 
  ggplot(aes(x = return_amount, y = value, fill = investment_capital))+
  geom_bar(position = 'fill', stat = 'identity', alpha = .8)+
  scale_fill_nejm()

millionaire_data |> 
  filter(id != 'multiple_investment_large_reinvest', id != 'multiple_investment_medium_reinvest', 
         id != 'single_investment_large_reinvest', id != 'single_investment_medium_reinvest') |> 
  select(-id, -sim_label, -investment_table) |> 
  pivot_longer(c(-investor_type, -investment_capital), names_to = 'return_amount', values_to = 'value') |> 
  ggplot(aes(x = return_amount, y = value, fill = investment_capital))+
  geom_bar(position = 'fill', stat = 'identity', alpha = .8)+
  facet_wrap(~investor_type)+
  scale_fill_nejm()
  
profits_data |> 
  group_by(investor_type) |> 
  summarise(across(where(is.numeric), \(x) mean(x)))
```
